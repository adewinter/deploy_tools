

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>deploy_tools.fabfile &mdash; Dimagi Deploy Tools 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Dimagi Deploy Tools 0.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Dimagi Deploy Tools 0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for deploy_tools.fabfile</h1><pre>
"""
The meat.

Goes through your settings file to determine what modules you've included

If you call 'deploy' here, deploy will variously be called in each module you've listed in settings (if applicable).

E.g. deploy in 'web' will mean a refresh of the HTTPD config file and a restart of the service,
     in 'packages' it will simply mean checking the requirements files specified in settings to make sure everything is up to date.
     in 'django' it will mean checking out the git repo, relevant submodules and a refresh of the localsettings.py file.

Similar concepts apply to 'bootstrap', 'stop', 'start' and 'restart'.
"""

from fabric.api import *
from fabric.colors import red
from fabric.contrib import files, console
from fabric import utils
from fabric.decorators import hosts

from modules.utils import what_os, try_import
import settings as deploy_settings
import posixpath



def _setup_env():
    #set up env based on settings info
    env.deploy_root = posixpath.dirname(__file__)
    env.home = posixpath.split(env.deploy_root)
    env.deploy_modules = deploy_settings.MODULES


def hello():
    print "testing OS:"
    print what_os()
    

def production():
    env.deploy_level = 'production'
    _setup_env()

def staging():
    env.deploy_level = 'staging'
    _setup_env()

def _run_command(cmd,module=None,*args,**kwargs):
    """
    Calls the given command on a single specified module (specified with the 'mod' argument.
    """
    if module is None:
        modules = env.deploy_modules
    else:
        modules = [module]
    for m in modules:
        mod = try_import(m)
        if mod is not None:
            getattr(mod,cmd)(args,kwargs)
        else:
            print red('Failed to import Module: %s. Command "%s" not executed.' % (m, cmd))
            utils.abort('Failed to import Module: %s. Command "%s" not executed.' % (m, cmd))

<div class="viewcode-block" id="deploy"><a class="viewcode-back" href="../../core.html#deploy_tools.fabfile.deploy">[docs]</a>def deploy(module=None):
    """
    Runs the deploy command for each module.

    If 'module' argument is specified, this command will only be run for that specific module.

    'Deployment' is usually associated with a refreshing/updating
    of content/data
    """
    _run_command('deploy',module,deploy_level=env.deploy_level)

</div>
<div class="viewcode-block" id="bootstrap"><a class="viewcode-back" href="../../core.html#deploy_tools.fabfile.bootstrap">[docs]</a>def bootstrap(module=None):
    """
    Runs the bootstrap command for each module.

    If 'module' argument is specified, this command will only be run for that specific module.

    Bootstrapping is usually associated with initial setup or
    the module being called upon for the first time.
    """
    _run_command('bootstrap',module,deploy_level=env.deploy_level)

</div>
<div class="viewcode-block" id="start"><a class="viewcode-back" href="../../core.html#deploy_tools.fabfile.start">[docs]</a>def start(module=None):
    """
    Runs the start command for each module.

    If 'module' argument is specified, this command will only be run for that specific module.

    'Starting' is usually associated with services that can be started/stopped. (Useful for restarting services manually)
    """
    _run_command('start',module,deploy_level=env.deploy_level)
</div>
<div class="viewcode-block" id="stop"><a class="viewcode-back" href="../../core.html#deploy_tools.fabfile.stop">[docs]</a>def stop(module=None):
    """
    Runs the stop command for each module.

    If 'module' argument is specified, this command will only be run for that specific module.

    'Stopping' is usually associated with services that can be started/stopped. (Useful for restarting services manually)
    """
    _run_command('stop', module, deploy_level=env.deploy_level)

</div>
</pre>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Dimagi Deploy Tools 0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Anton de Winter.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>